"use strict";(self.webpackChunkga_4_dataform=self.webpackChunkga_4_dataform||[]).push([[369],{6557:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var i=s(4848),t=s(8453);const r={title:"Other References",description:"Overview of others functionalities and capabilities of the product.",slug:"/references-others"},a=void 0,c={id:"references/others",title:"Other References",description:"Overview of others functionalities and capabilities of the product.",source:"@site/docs/references/others.md",sourceDirName:"references",slug:"/references-others",permalink:"/docs/references-others",draft:!1,unlisted:!1,editUrl:"https://github.com/<your-org>/<your-repo>/edit/main/docs/docs/references/others.md",tags:[],version:"current",frontMatter:{title:"Other References",description:"Overview of others functionalities and capabilities of the product.",slug:"/references-others"},sidebar:"tutorialSidebar",previous:{title:"User Stitching",permalink:"/docs/user-stitching"},next:{title:"Data Dictionary",permalink:"/docs/category/data-dictionary"}},o={},d=[];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(s,{id:"incremental-loading",children:[(0,i.jsx)("summary",{children:"Incremental loading"}),(0,i.jsx)("p",{children:"The incrementality works by processing only new GA4 event data without reprocessing the entire dataset. Here's a summary of how this is implemented:"}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. Checkpoint Management:"})}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.code,{children:"date_checkpoint"})," variable is declared and set to the day after the most recent ",(0,i.jsx)(n.code,{children:"event_date"})," found in the existing table (",(0,i.jsx)(n.code,{children:"stg_ga4_events"}),")."]}),"\n",(0,i.jsx)(n.li,{children:"This ensures that only data newer than the most recent processed date is considered for the next load."}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"set date_checkpoint = (\n  select max(event_date) + 1 \n  from `project_id.superform_transformations.stg_ga4_events` \n  where is_final = true\n);\n"})}),(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Deletion of Updated Data:"})}),"\n"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Any existing records from the target table (",(0,i.jsx)(n.code,{children:"stg_ga4_events"}),") where ",(0,i.jsx)(n.code,{children:"event_date"})," is equal to or greater than the ",(0,i.jsx)(n.code,{children:"date_checkpoint"})," are deleted. This ensures that if GA4 has re-processed any past data, it gets removed and replaced by fresh data."]}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"delete from `project_id.superform_transformations.stg_ga4_events`\nwhere event_date >= date_checkpoint;\n"})}),(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Filtering New Data:"})}),"\n"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The pipeline processes only the new GA4 events by using ",(0,i.jsx)(n.code,{children:"_table_suffix"})," to fetch data from BigQuery tables (",(0,i.jsx)(n.code,{children:"events_*"}),") where the ",(0,i.jsx)(n.code,{children:"event_date"})," (derived from ",(0,i.jsx)(n.code,{children:"_table_suffix"}),") is greater than or equal to the ",(0,i.jsx)(n.code,{children:"date_checkpoint"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"This prevents reprocessing old event data."}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"and parse_date('%Y%m%d', regexp_extract(_table_suffix, '[0-9]+')) >= date_checkpoint;\n"})}),(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Filtering out Intraday Events:"})}),"\n"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Intraday data, which might still be incomplete or subject to change, is excluded from the query using this condition:"}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"and contains_substr(_table_suffix, 'intraday') is false;\n"})}),(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Finalization Logic:"})}),"\n"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The field ",(0,i.jsx)(n.code,{children:"is_final"})," is computed in the process to determine whether the data is final (older than 3 days). This is used to manage the checkpoint logic, ensuring incremental processing only on data that is finalized."]}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"date_diff(current_date(), cast(event_date as date format 'YYYYMMDD'), day) > 3 as is_final;\n"})})]}),"\n",(0,i.jsxs)(s,{id:"partitioning-clustering",children:[(0,i.jsx)("summary",{children:"Partitioning & Clustering"}),(0,i.jsx)("p",{children:"Our tables use date-based partitioning rather than GA4's default date-sharding approach, leading to better performance and simpler query patterns."}),(0,i.jsx)("p",{children:"We have implemented clustering on all tables to potentially optimize query speeds and reduce processing costs."}),(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Table"}),(0,i.jsx)(n.th,{children:"Partitioned By"}),(0,i.jsx)(n.th,{children:"Clustered By"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"demo_daily_sessions_report.sqlx"}),(0,i.jsx)(n.td,{children:"session_date"}),(0,i.jsx)(n.td,{children:"None"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ga4_events.sqlx"}),(0,i.jsx)(n.td,{children:"event_date"}),(0,i.jsx)(n.td,{children:"event_name, session_id"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"int_ga4_sessions.sqlx"}),(0,i.jsx)(n.td,{children:"session_date"}),(0,i.jsx)(n.td,{children:"session_id"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ga4_sessions.sqlx"}),(0,i.jsx)(n.td,{children:"session_date"}),(0,i.jsx)(n.td,{children:"session_id"})]})]})]}),(0,i.jsx)(n.admonition,{title:"Custom Clustering (Premium)",type:"tip",children:(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.a,{href:"/docs/configuration-variables#cluster-by",children:(0,i.jsx)(n.code,{children:"CLUSTER_BY"})})," config to prepend custom columns before the fixed trailing columns. For example, in multi-property setups you can cluster by ",(0,i.jsx)(n.code,{children:"property_id"})," for faster filtered queries."]})})]}),"\n",(0,i.jsxs)(s,{id:"on-schema-change",children:[(0,i.jsx)("summary",{children:"Schema Evolution (onSchemaChange)"}),(0,i.jsxs)("p",{children:["All intermediate and output tables use ",(0,i.jsx)("code",{children:'onSchemaChange: "extend"'}),". When a new standalone top-level column is added, BigQuery automatically extends the table schema without requiring a full rebuild. Existing columns are never removed or modified."]}),(0,i.jsxs)("p",{children:["This means you can enable ",(0,i.jsx)("code",{children:"EXTRA_GA4_DATASETS_ARRAY"})," (which adds ",(0,i.jsx)("code",{children:"property_name"}),") or add ",(0,i.jsx)("code",{children:"CLUSTER_BY"})," columns, and the next incremental run will pick them up."]}),(0,i.jsx)(n.admonition,{title:"STRUCT fields require a full rebuild",type:"warning",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"onSchemaChange: EXTEND"})," only works for standalone (top-level) columns. New fields inside STRUCTs - such as adding entries to ",(0,i.jsx)(n.code,{children:"CUSTOM_EVENT_PARAMS_ARRAY"}),", ",(0,i.jsx)(n.code,{children:"CUSTOM_USER_PROPERTIES_ARRAY"}),", ",(0,i.jsx)(n.code,{children:"CUSTOM_SESSION_PARAMS_ARRAY"}),", or ",(0,i.jsx)(n.code,{children:"CUSTOM_SESSION_TOTALS"})," - are ",(0,i.jsx)(n.strong,{children:"not"})," handled automatically. Adding new custom parameters requires a full rebuild of the affected tables (or a custom schema update)."]})})]}),"\n",(0,i.jsxs)(s,{id:"last-non-direct-click-session-source",children:[(0,i.jsx)("summary",{children:"Last Non-Direct Click Session Source"}),(0,i.jsxs)("p",{children:["Whether you agree with last non-direct click attribution or not, GA4 UI predominantly uses this model for conversion attribution. We replicated this approach to provide you with a more comparable dataset. Whether you should compare the GA4 UI to the BigQuery export is another question. For more insight, check out ",(0,i.jsx)("a",{href:"https://developers.google.com/analytics/blog/2023/bigquery-vs-ui",target:"_blank",children:"this article"}),"."]})]}),"\n",(0,i.jsxs)(s,{id:"comprehensive-ga4-data-diagnostics",children:[(0,i.jsx)("summary",{children:"Comprehensive GA4 Data Diagnostics"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Cardinality Analysis:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tracks unique pages, sources, mediums, and campaign names"}),"\n",(0,i.jsx)(n.li,{children:"Monitors hostname variations"}),"\n",(0,i.jsx)(n.li,{children:"Provides both daily and weekly views"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Data Quality Checks:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Identifies duplicate transaction IDs"}),"\n",(0,i.jsx)(n.li,{children:"Detects empty item payloads in ecommerce events"}),"\n",(0,i.jsx)(n.li,{children:"Monitors cookieless hits and measurement protocol hits"}),"\n",(0,i.jsx)(n.li,{children:"Tracks self-referral sessions"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Performance Metrics:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Complete ecommerce event tracking"}),"\n",(0,i.jsx)(n.li,{children:"Session quality monitoring"}),"\n",(0,i.jsx)(n.li,{children:"Referrer analysis and tracking"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Diagnostic Ratios:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Calculates percentages of problematic events"}),"\n",(0,i.jsx)(n.li,{children:"Tracks data collection quality metrics"}),"\n",(0,i.jsx)(n.li,{children:"Monitors implementation consistency"}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,i.jsxs)(s,{id:"event-id",children:[(0,i.jsx)("summary",{children:"Event ID"}),(0,i.jsx)("p",{children:"We create a unique event ID based on event_name, event_timestamp, user_pseudo_id, ga_session_id, batch_page_id, batch_ordering_id, batch_event_index, engagement_time_msec."})]}),"\n",(0,i.jsxs)(s,{id:"timestamp-handling",children:[(0,i.jsx)("summary",{children:"Timestamp Handling"}),(0,i.jsx)("p",{children:"Standardized timestamp struct containing event_date_YYYYMMDD, event_timestamp_micros, event_timestamp_utc, and user_first_touch_timestamp for consistent temporal analysis."})]}),"\n",(0,i.jsxs)(s,{id:"landing-and-exit-page-tracking",children:[(0,i.jsx)("summary",{children:"Landing and Exit Page Tracking"}),(0,i.jsx)("p",{children:"We automatically capture and structure session landing and exit pages for seamless funnel analysis and user journey tracking."})]}),"\n",(0,i.jsxs)(s,{id:"session-indicators",children:[(0,i.jsx)("summary",{children:"Session Indicators"}),(0,i.jsx)("p",{children:"Built-in flags for engaged sessions and debug sessions to help monitor data collection quality."})]}),"\n",(0,i.jsxs)(s,{id:"cross-domain-tracking",children:[(0,i.jsx)("summary",{children:"Cross-Domain Tracking"}),(0,i.jsx)("p",{children:"Supports cross-domain tracking through _gl parameter handling in URL parameters."})]}),"\n",(0,i.jsxs)(s,{id:"traffic-source-detection",children:[(0,i.jsx)("summary",{children:"Traffic Source Detection"}),(0,i.jsx)("p",{children:"Boolean flag indicating the presence of traffic source data for comprehensive attribution tracking."})]}),"\n",(0,i.jsxs)(s,{id:"default-channel-grouping",children:[(0,i.jsx)("summary",{children:"Default Channel Grouping"}),(0,i.jsxs)("p",{children:["We\u2019ve implemented GA4\u2019s ",(0,i.jsx)(n.a,{href:"https://support.google.com/analytics/answer/9756891",children:"Default Channel Grouping"})," logic as a JavaScript function. While our implementation closely mirrors GA4's behavior, it may not provide exact matches in all cases. This is primarily because the BigQuery export does not include certain parameters that GA4 uses in its grouping logic, such as ",(0,i.jsx)(n.em,{children:"Source platform"})," and ",(0,i.jsx)(n.em,{children:"Google Ads campaign type"}),". As a result, discrepancies might appear between GA4 UI groupings and our classification."]})]}),"\n",(0,i.jsxs)(s,{id:"standard-event-parameters",children:[(0,i.jsx)("summary",{children:"Standard Event Parameters"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'const CORE_PARAMS_ARRAY = [\n  // never remove, do not rename - this can break the core model\n\n  {\n      type: "string",\n      name: "ignore_referrer"\n  },\n  {\n      type: "int",\n      name: "ga_session_id"\n  },\n  {\n      type: "int",\n      name: "ga_session_number"\n  },\n  // and on and on\n];\n'})}),(0,i.jsxs)(n.p,{children:[(0,i.jsx)("strong",{children:"Description"}),": Essential event parameters that are required for the core functionality of GA4Dataform. These parameters should never be removed or renamed as they are critical for features like session tracking and referral handling. Each parameter is strictly typed and serves a specific purpose in the data model."]})]}),"\n",(0,i.jsxs)(s,{id:"standard-url-parameters",children:[(0,i.jsx)("summary",{children:"Standard URL Parameters"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'const URL_PARAMS_ARRAY = [\n  // url parameters to extract to own column\n\n  { name: "utm_marketing_tactic",cleaningMethod: lowerSQL},\n  { name: "utm_source_platform",cleaningMethod: lowerSQL },\n  { name: "utm_term",cleaningMethod: lowerSQL },\n  { name: "utm_content",cleaningMethod: lowerSQL },\n  { name: "utm_source",cleaningMethod: lowerSQL },\n  { name: "utm_medium",cleaningMethod: lowerSQL },\n  { name: "utm_campaign",cleaningMethod: lowerSQL },\n  { name: "utm_id",cleaningMethod: lowerSQL },\n  { name: "utm_creative_format",cleaningMethod: lowerSQL },\n\n  // gtm and ga\n  { name: "gtm_debug" },\n  { name: "_gl" }\n];\n'})}),(0,i.jsxs)(n.p,{children:[(0,i.jsx)("strong",{children:"Description"}),": A predefined list of URL parameters that we extract and process from your website's URLs. This includes standard UTM parameters for campaign tracking, as well as Google Tag Manager and Google Analytics specific parameters. Each parameter can have an optional cleaning method (e.g., converting to lowercase) applied during extraction."]})]}),"\n",(0,i.jsxs)(s,{id:"click-id-parsing-from-url",children:[(0,i.jsx)("summary",{children:"Click ID parsing from URL"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:'const CLICK_IDS_ARRAY = [\n// how to classify click ids (from collected_traffic_source) when there is no source/medium/campaign found?\n// (defaults should be fine)\n\n// name: from collected_traffic_source\n// medium and campaign: fill in with this value when needed (meaning: when found to be organic/referral)\n// note: we never overwrite MEDIUM, CAMPAIGN if explitly set. We only overwrite when campaign is "(organic)", "(referral)" or NULL\n{name:\'gclid\', source:"google", medium:"cpc", campaign: "(not set)", sources:["url","collected_traffic_source"] },\n{name:\'dclid\', source:"google", medium:"cpc", campaign: "(not set)", sources:["url","collected_traffic_source"] },\n{name:\'srsltid\', source:"google", medium:"organic", campaign: "Shopping Free Listings", sources:["url","collected_traffic_source"] },\n{name:\'gbraid\', source:"google",  medium:"cpc", campaign: "(not set)", sources:["url"]},\n{name:\'wbraid\', source:"google",  medium:"cpc", campaign: "(not set)", sources:["url"] },\n{name:\'msclkid\', source:"bing", medium:"cpc", campaign: "(not set)", sources:["url"] }\n];\n'})}),(0,i.jsxs)(n.p,{children:[(0,i.jsx)("strong",{children:"Description"}),": Defines how different advertising click IDs (like Google Ads' gclid or Microsoft Ads' msclkid) should be interpreted when determining traffic sources. Each entry specifies default values for source, medium, and campaign that should be applied when these IDs are present but no explicit UTM parameters are set. This ensures consistent attribution across different advertising platforms."]})]}),"\n",(0,i.jsxs)(s,{id:"data-is-final-days-incrementality-variable",children:[(0,i.jsx)("summary",{children:"DATA_IS_FINAL_DAYS - Incrementality variable"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const DATA_IS_FINAL_DAYS = 3;\n"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"date_diff(current_date(), cast(event_date as date format 'YYYYMMDD'), day) > ${config.DATA_IS_FINAL_DAYS} as is_final\n"})}),(0,i.jsxs)(n.p,{children:[(0,i.jsx)("strong",{children:"Description"}),': Defines how many days must pass before we consider GA4 data to be "final" (no longer subject to changes). This value is used in incremental processing to determine which data should be reprocessed. The default value is set to 3 days because GA4 Measurement Protocol allows hits to be sent up to 72 hours in the past.']})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var i=s(6540);const t={},r=i.createContext(t);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);