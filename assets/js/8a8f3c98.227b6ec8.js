"use strict";(self.webpackChunkga_4_dataform=self.webpackChunkga_4_dataform||[]).push([[6317],{7609:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>c,toc:()=>a});var t=s(4848),i=s(8453);const r={title:"Transactions",description:"Information about Transaction model",slug:"/output-tables/transactions"},o=void 0,c={id:"references/output-tables/transactions",title:"Transactions",description:"Information about Transaction model",source:"@site/docs/references/output-tables/transactions.md",sourceDirName:"references/output-tables",slug:"/output-tables/transactions",permalink:"/docs/output-tables/transactions",draft:!1,unlisted:!1,editUrl:"https://github.com/<your-org>/<your-repo>/edit/main/docs/docs/references/output-tables/transactions.md",tags:[],version:"current",frontMatter:{title:"Transactions",description:"Information about Transaction model",slug:"/output-tables/transactions"},sidebar:"tutorialSidebar",previous:{title:"Output tables",permalink:"/docs/category/output-tables"},next:{title:"Events",permalink:"/docs/output-tables/events"}},l={},a=[{value:"Design &amp; Features",id:"design--features",level:2},{value:"Config options",id:"config-options",level:2}];function d(n){const e={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h2,{id:"design--features",children:"Design & Features"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["have a 1 row per transaction table","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["incremental appending (INT) - built from ",(0,t.jsx)(e.code,{children:"ga4_events"})]}),"\n",(0,t.jsxs)(e.li,{children:["full scan for functions that are outside the increment window (OUTPUT)","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"deduplication (optional)"}),"\n",(0,t.jsx)(e.li,{children:"refund aggregation"}),"\n",(0,t.jsx)(e.li,{children:"running customer totals"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"property_id"})," and ",(0,t.jsx)(e.code,{children:"property_name"})," columns for multi-property identification"]}),"\n",(0,t.jsx)(e.li,{children:"nested: items (1 transaction can have multiple items)"}),"\n",(0,t.jsxs)(e.li,{children:["nested: refunds (1 transaction can have multiple refunds)","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["a refund row is basically the same as a transaction row: 1 row per refund","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"nested: the refunded items"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.li,{children:"aggregated: transaction metrics, item metrics, refund metrics"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"config-options",children:"Config options"}),"\n",(0,t.jsx)(e.p,{children:"Defaults:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:'  // by default, we leave duplicate transaction_ids alone, but you can deduplicate here  \n  // note: setting this to true will still keep all transactions with NULL transaction_id  \n  TRANSACTIONS_DEDUPE: false,  \n\n  // we keep a running count for transactions, based on an identifier. Defaults to "user_pseudo_id"  \n  // if you have another one, you can change it here (e.g. "user_id" - make sure it\'s a valid column)  \n  TRANSACTION_TOTALS_UID: \'user_pseudo_id\',  \n'})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"TRANSACTIONS_DEDUPE` is used in **definitions/core/03_outputs/ga4_transactions.sqlx**  \n"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["column ",(0,t.jsx)(e.code,{children:"duplicate_count"})," is ",(0,t.jsx)(e.code,{children:"1"})," if not duplicate, or ",(0,t.jsx)(e.code,{children:"2"}),", ",(0,t.jsx)(e.code,{children:"3"}),", etc if duplicate ",(0,t.jsx)(e.code,{children:"transaction_id"})," found"]}),"\n",(0,t.jsxs)(e.li,{children:["if ",(0,t.jsx)(e.code,{children:"TRANSACTIONS_DEDUPE"})," is ",(0,t.jsx)(e.code,{children:"true"}),", then only the 1st transaction ID ends up in the table","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["via helper function ",(0,t.jsx)(e.code,{children:"generateTransactionsDedupeSQL"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.code,{children:"TRANSACTION_TOTALS_UID"})," is used like this:"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["a column is SELECTed from ",(0,t.jsx)(e.code,{children:"ga4_events"})," and added to ",(0,t.jsx)(e.strong,{children:"definitions/core/02_intermediate/int_ga4_transactions.sqlx"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["this can be any column of the events table.","\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"user_pseudo_id"})," \u2190 default"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"user_id"})," (a logical choice)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"event_params_custom.email_hash"})," \u2190 super custom"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.code,{children:"coalesce(user_id, user_pseudo_id)"})," \u2190 super power user trick"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.code,{children:"${config.TRANSACTION_TOTALS_UID} as uid"})}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["in ",(0,t.jsx)(e.strong,{children:"definitions/core/03_outputs/ga4_transactions.sqlx"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"fill running totals column"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{children:"struct(  \n    if( uid is null, null, row_number() over user ) as transactions,   \n    if( uid is null, null, sum(ecommerce.purchase_revenue) over user ) as purchase_revenue,  \n    ...  \n) as running_totals,  \nwindow user as ( partition by uid order by time.event_timestamp )  \n"})})]})}function u(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453:(n,e,s)=>{s.d(e,{R:()=>o,x:()=>c});var t=s(6540);const i={},r=t.createContext(i);function o(n){const e=t.useContext(r);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);