"use strict";(self.webpackChunkga_4_dataform=self.webpackChunkga_4_dataform||[]).push([[758],{3366:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>c});var i=n(4848),r=n(8453);const t={title:"Product Features",description:"Overview of the key functionalities and capabilities of the product.",sidebar_position:4,slug:"/product-features"},a=void 0,o={id:"ga4dataform-doc/product-features",title:"Product Features",description:"Overview of the key functionalities and capabilities of the product.",source:"@site/docs/ga4dataform-doc/product-features.md",sourceDirName:"ga4dataform-doc",slug:"/product-features",permalink:"/ga4dataform/docs/product-features",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/ga4dataform-doc/product-features.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Product Features",description:"Overview of the key functionalities and capabilities of the product.",sidebar_position:4,slug:"/product-features"},sidebar:"tutorialSidebar",previous:{title:"Getting Started",permalink:"/ga4dataform/docs/geting-started"},next:{title:"Custom Configuration",permalink:"/ga4dataform/docs/custom-configuration"}},d={},c=[{value:"Core Features",id:"core-features",level:2},{value:"Basic features",id:"basic-features",level:3},{value:"Common Session Processing Pipeline",id:"common-session-processing-pipeline",level:3},{value:"Additional Features",id:"additional-features",level:3}];function l(e){const s={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components},{Details:n}=s;return n||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h2,{id:"core-features",children:"Core Features"}),"\n",(0,i.jsx)(s.h3,{id:"basic-features",children:"Basic features"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Custom Configuration"}),(0,i.jsx)("p",{children:'A single configuration file lets you control all aspects of your data processing: from unnesting custom parameters (event, item, URL) and user properties to filtering data based on hostname or event_name dimensions. Check out the "Custom Configuration" tab to learn more!'})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Incremental loading"}),(0,i.jsx)("p",{children:"The incrementality works by processing only new GA4 event data without reprocessing the entire dataset. Here's a summary of how this is implemented:"}),(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"1. Checkpoint Management:"})}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["A ",(0,i.jsx)(s.code,{children:"date_checkpoint"})," variable is declared and set to the day after the most recent ",(0,i.jsx)(s.code,{children:"event_date"})," found in the existing table (",(0,i.jsx)(s.code,{children:"stg_ga4_events"}),")."]}),"\n",(0,i.jsx)(s.li,{children:"This ensures that only data newer than the most recent processed date is considered for the next load."}),"\n"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"set date_checkpoint = (\nselect max(event_date) + 1 \nfrom `project_id.superform_transformations.stg_ga4_events` \nwhere is_final = true\n);\n"})}),(0,i.jsxs)(s.ol,{start:"2",children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.strong,{children:"Deletion of Updated Data:"})}),"\n"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Any existing records from the target table (",(0,i.jsx)(s.code,{children:"stg_ga4_events"}),") where ",(0,i.jsx)(s.code,{children:"event_date"})," is equal to or greater than the ",(0,i.jsx)(s.code,{children:"date_checkpoint"})," are deleted. This ensures that if GA4 has re-processed any past data, it gets removed and replaced by fresh data."]}),"\n"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"delete from `project_id.superform_transformations.stg_ga4_events`\nwhere event_date >= date_checkpoint;\n"})}),(0,i.jsxs)(s.ol,{start:"3",children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.strong,{children:"Filtering New Data:"})}),"\n"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["The pipeline processes only the new GA4 events by using ",(0,i.jsx)(s.code,{children:"_table_suffix"})," to fetch data from BigQuery tables (",(0,i.jsx)(s.code,{children:"events_*"}),") where the ",(0,i.jsx)(s.code,{children:"event_date"})," (derived from ",(0,i.jsx)(s.code,{children:"_table_suffix"}),") is greater than or equal to the ",(0,i.jsx)(s.code,{children:"date_checkpoint"}),"."]}),"\n",(0,i.jsx)(s.li,{children:"This prevents reprocessing old event data."}),"\n"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"and parse_date('%Y%m%d', regexp_extract(_table_suffix, '[0-9]+')) >= date_checkpoint;\n"})}),(0,i.jsxs)(s.ol,{start:"4",children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.strong,{children:"Filtering out Intraday Events:"})}),"\n"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Intraday data, which might still be incomplete or subject to change, is excluded from the query using this condition:"}),"\n"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"and contains_substr(_table_suffix, 'intraday') is false;\n"})}),(0,i.jsxs)(s.ol,{start:"5",children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.strong,{children:"Finalization Logic:"})}),"\n"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["The field ",(0,i.jsx)(s.code,{children:"is_final"})," is computed in the process to determine whether the data is final (older than 3 days). This is used to manage the checkpoint logic, ensuring incremental processing only on data that is finalized."]}),"\n"]}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"date_diff(current_date(), cast(event_date as date format 'YYYYMMDD'), day) > 3 as is_final;\n"})})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Partitioning & Clustering"}),(0,i.jsx)("p",{children:"Our tables use date-based partitioning rather than GA4's default date-sharding approach, leading to better performance and simpler query patterns."}),(0,i.jsx)("p",{children:"We have implemented clustering on all tables to potentially optimize query speeds and reduce processing costs."}),(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Table"}),(0,i.jsx)(s.th,{children:"Partitioned By"}),(0,i.jsx)(s.th,{children:"Clustered By"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"demo_daily_sessions_report.sqlx"}),(0,i.jsx)(s.td,{children:"session_date"}),(0,i.jsx)(s.td,{children:"None"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"stg_ga4_events.sqlx"}),(0,i.jsx)(s.td,{children:"event_date"}),(0,i.jsx)(s.td,{children:"event_name"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"int_ga4_events.sqlx"}),(0,i.jsx)(s.td,{children:"event_date"}),(0,i.jsx)(s.td,{children:"event_name, session_id"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"int_ga4_sessions.sqlx"}),(0,i.jsx)(s.td,{children:"session_date"}),(0,i.jsx)(s.td,{children:"session_id"})]})]})]})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Default Channel Grouping"}),(0,i.jsx)("p",{children:'We implemented GA4\'s Default Channel Grouping logic as a JavaScript function. While our implementation closely mirrors GA4\'s behavior, it may not provide exact matches in all cases since the BigQuery export lacks certain parameters used in GA4\'s channel grouping (e.g.: "Source platform" and "Google Ads campaign type").'}),(0,i.jsx)("p",{children:"Feel free to use our helper function as a template to create your own, custom channel grouping!"})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Last Non-Direct Click Session Source"}),(0,i.jsxs)("p",{children:["Whether you agree with last non-direct click attribution or not, GA4 UI predominantly uses this model for conversion attribution. We replicated this approach to provide you with a more comparable dataset. Whether you should compare the GA4 UI to the BigQuery export is another question. For more insight, check out ",(0,i.jsx)("a",{href:"https://developers.google.com/analytics/blog/2023/bigquery-vs-ui",target:"_blank",children:"this article"}),"."]})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Sessionization"}),(0,i.jsx)("p",{children:"The GA4 session table provide the following information:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Source / Medium / Campaign"})," for at least three standard attributions:","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Last click"}),"\n",(0,i.jsx)(s.li,{children:"Last non-direct click (with a particular lookback window, default 90 days)"}),"\n",(0,i.jsx)(s.li,{children:"First click"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["For each attribution, ",(0,i.jsx)(s.strong,{children:"Default Channel Groups"})," \u2014 following the same rules as in Google Analytics 4."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Landing page, landing page referrer, and exit page"}),", which can also be structured with a prepared hostname, page path, and query parameters."]}),"\n",(0,i.jsxs)(s.li,{children:["Session properties like: ",(0,i.jsx)(s.code,{children:"is_direct_session"}),", ",(0,i.jsx)(s.code,{children:"is_engaged_session"}),", ",(0,i.jsx)(s.code,{children:"is_debug_session"}),", ",(0,i.jsx)(s.code,{children:"is_cross_domain"})]}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.strong,{children:"Unique session_id"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.strong,{children:"Session duration"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.strong,{children:"engagement time"})}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"User information:"})," ",(0,i.jsx)(s.code,{children:"user_id"}),", ",(0,i.jsx)(s.code,{children:"last_user_id"}),", ",(0,i.jsx)(s.code,{children:"user_pseudo_id"})]}),"\n",(0,i.jsx)(s.li,{children:"etc..."}),"\n"]}),(0,i.jsx)("p",{children:"These columns are often essential for building reports and simplifying data pipelines based on session data."}),(0,i.jsx)(s.h3,{id:"common-session-processing-pipeline",children:"Common Session Processing Pipeline"}),(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Extract all necessary columns"})," from raw GA4 data to flat event tables."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Clean and prepare events"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Group events into sessions"})," using the unique ",(0,i.jsx)(s.code,{children:"session_id"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Adjust Google\u2019s default source / medium rules"})," and add channel grouping."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Add last non-direct attribution"}),"."]}),"\n"]}),(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Sources to calculate source / medium include:"})}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"collected_traffic_source"})," column"]}),"\n",(0,i.jsxs)(s.li,{children:["Source and medium from ",(0,i.jsx)(s.code,{children:"event_params"})]}),"\n",(0,i.jsxs)(s.li,{children:["UTM parameters from ",(0,i.jsx)(s.code,{children:"page_location"})]}),"\n",(0,i.jsxs)(s.li,{children:["Click IDs from ",(0,i.jsx)(s.code,{children:"event_params"})," or ",(0,i.jsx)(s.code,{children:"page_location"}),", such as ",(0,i.jsx)(s.code,{children:"gbraid"}),", ",(0,i.jsx)(s.code,{children:"wbraid"}),", ",(0,i.jsx)(s.code,{children:"gclid"}),", ",(0,i.jsx)(s.code,{children:"dclid"}),", ",(0,i.jsx)(s.code,{children:"srsltid"}),", and more."]}),"\n"]}),(0,i.jsx)("p",{children:"Once all sources are combined, additional logic is applied to create a fixed source/medium. For example:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["If ",(0,i.jsx)(s.code,{children:"gclid"}),", ",(0,i.jsx)(s.code,{children:"gbraid"}),", or ",(0,i.jsx)(s.code,{children:"wbraid"})," is present, then source/medium should be ",(0,i.jsx)(s.code,{children:"google / cpc"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:["If the referrer matches ",(0,i.jsx)(s.code,{children:"%android-app://com.google%"}),", then source/medium should be ",(0,i.jsx)(s.code,{children:"google / organic"}),"."]}),"\n",(0,i.jsx)(s.li,{children:"There are special rules for click IDs, social platforms, and apps."}),"\n"]}),(0,i.jsx)("p",{children:"For channel grouping, Google provides a list with over 1,100 rules to define groups for known domains."}),(0,i.jsxs)("p",{children:["After these steps, we calculate last non-direct attribution and compare it with the GA UI and values in ",(0,i.jsx)(s.code,{children:"session_traffic_source_last_click"}),". Source/medium fixes can sometimes reduce direct traffic by 15-20%, improving attribution for paid campaigns."]})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Google Ads Traffic Misattribution Fix"}),(0,i.jsx)("p",{children:'A known issue in GA4\'s BigQuery export is the misclassification of Google Ads traffic as organic search when a "gclid" parameter is present. Our solution automatically corrects this misattribution by properly classifying events as paid traffic when gclid, gbraid, or wbraid parameters are detected.'})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Looker Studio Report Template"}),(0,i.jsx)("p",{children:"Access our ready-to-use Looker Studio dashboard template to jumpstart your GA4 reporting and analysis (coming soon)."})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Basic Data Quality Checks"}),(0,i.jsx)("p",{children:"We include customized data validation rules for GA4 that can be easily enabled or disabled through the configuration file. See the assertions section for more details"})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Comprehensive GA4 Data Diagnostics"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Cardinality Analysis:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Tracks unique pages, sources, mediums, and campaign names"}),"\n",(0,i.jsx)(s.li,{children:"Monitors hostname variations"}),"\n",(0,i.jsx)(s.li,{children:"Provides both daily and weekly views"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Data Quality Checks:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Identifies duplicate transaction IDs"}),"\n",(0,i.jsx)(s.li,{children:"Detects empty item payloads in ecommerce events"}),"\n",(0,i.jsx)(s.li,{children:"Monitors cookieless hits and measurement protocol hits"}),"\n",(0,i.jsx)(s.li,{children:"Tracks self-referral sessions"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Performance Metrics:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Complete ecommerce event tracking"}),"\n",(0,i.jsx)(s.li,{children:"Session quality monitoring"}),"\n",(0,i.jsx)(s.li,{children:"Referrer analysis and tracking"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Diagnostic Ratios:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Calculates percentages of problematic events"}),"\n",(0,i.jsx)(s.li,{children:"Tracks data collection quality metrics"}),"\n",(0,i.jsx)(s.li,{children:"Monitors implementation consistency"}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,i.jsx)(s.h3,{id:"additional-features",children:"Additional Features"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Event ID"}),(0,i.jsx)("p",{children:"We create a unique event ID based on event_name, event_timestamp, user_pseudo_id, ga_session_id, batch_page_id, batch_ordering_id, batch_event_index, engagement_time_msec."})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Timestamp Handling"}),(0,i.jsx)("p",{children:"Standardized timestamp struct containing event_date_YYYYMMDD, event_timestamp_micros, event_timestamp_utc, and user_first_touch_timestamp for consistent temporal analysis."})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Landing and Exit Page Tracking"}),(0,i.jsx)("p",{children:"We automatically capture and structure session landing and exit pages for seamless funnel analysis and user journey tracking."})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Session Indicators"}),(0,i.jsx)("p",{children:"Built-in flags for engaged sessions and debug sessions to help monitor data collection quality."})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Cross-Domain Tracking"}),(0,i.jsx)("p",{children:"Supports cross-domain tracking through _gl parameter handling in URL parameters."})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Traffic Source Detection"}),(0,i.jsx)("p",{children:"Boolean flag indicating the presence of traffic source data for comprehensive attribution tracking."})]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>o});var i=n(6540);const r={},t=i.createContext(r);function a(e){const s=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:s},e.children)}}}]);